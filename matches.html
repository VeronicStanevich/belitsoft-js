<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MATCHES</title>
    <link rel="stylesheet" href="styles.css"/>
</head>
<body>
<div class="mainInformation">
    <div>
        <a class="back-link" href="index.html">Back to teams list</a>
        <div class="team" id="team">
            <h2 id="team_name" class="team_name"></h2>
            <table>
                <tr>
                    <td colspan="2" align="Center"><img src="" id="team_crestUrl" class="team_crestUrl"></td>
                </tr>
                <tr>
                    <td>Short name:</td>
                    <td id="team_shortName"></td>
                </tr>
                <tr>
                    <td>TLA:</td>
                    <td id="team_tla"></td>
                </tr>
                <tr>
                    <td>Address:</td>
                    <td id="team_address"></td>
                </tr>
                <tr>
                    <td>Phone:</td>
                    <td><a href="" id="team_phone"></a></td>
                </tr>
                <tr>
                    <td>Website:</td>
                    <td><a href="" id="team_website">Go to site</a></td>
                </tr>
                <tr>
                    <td>Email:</td>
                    <td><a id="team_email" href=""></a></td>
                </tr>
                <tr>
                    <td>Founded:</td>
                    <td id="team_founded"></td>
                </tr>
                <tr>
                    <td>Club colors:</td>
                    <td id="team_clubColors"></td>
                </tr>
            </table>
        </div>
    </div>
    <div class="nextMatches-block">
        <h2 class="nextMatches_title">Next matches</h2>
        <section class="loading"><h2 id="loading">Loading...</h2></section>
        <section class="error error_active">
            <h2 id="err"></h2>
        </section>
        <table class="nextMatches"></table>
    </div>
</div>
<script>
    (function () {
        const params = new URLSearchParams(location.search);
        const teamId = params.get('id');
        const headers = new Headers();
        headers.append('X-Auth-Token', 'f113f557ce2a428e8a46dc9e659212f8');
        fetch(`https://api.football-data.org/v2/teams/${teamId}`, {
                method: 'GET',
                headers: headers
            }
        )
            .then(res => res.json())
            .then((info) => {
                document.getElementById('team_name').innerText = info.name;
                document.getElementById('team_shortName').innerText = info.shortName || "N/A";
                document.getElementById('team_tla').innerText = info.tla || "N/A";
                document.getElementById('team_crestUrl').src = info.crestUrl || "N/A";
                document.getElementById('team_address').innerText = info.address || "N/A";
                document.getElementById('team_phone').innerText = info.phone || "N/A";
                document.getElementById('team_phone').href = "tel:" + info.phone || "N/A";
                document.getElementById('team_website').href = info.website || "N/A";
                document.getElementById('team_email').href = "mailto:" + info.email || "N/A";
                document.getElementById('team_email').innerText = info.email || "N/A";
                document.getElementById('team_founded').innerText = info.founded || "N/A";
                document.getElementById('team_clubColors').innerText = info.clubColors || "N/A";
            })
            .catch(err => {
                document.getElementById('err').innerText = "Failed to load :( " + err;
                document.getElementById('err').classList.toggle("error_active");
            }).finally(() => {
            document.getElementById('loading').classList.toggle("loading_disabled")
        });

        fetch(`https://api.football-data.org/v2/teams/${teamId}/matches?status=SCHEDULED,LIVE,IN_PLAY,PAUSED,POSTPONED,SUSPENDED `, {
                method: 'GET',
                headers: headers
            }
        )
            .then(res => res.json())
            .then(responseJSON => {
                function generateHTML(match) {
                    return `<tr class="nextMatches nextMatches_border">
                       <td class="nextMatches_border">Date: ${new Date(match.utcDate).toLocaleString()}</td>
                       <td class="nextMatches_border">Home: <a href="matches.html?id=${match.homeTeam.id}">${match.homeTeam.name}</a></td>
                       <td class="nextMatches_border">Away: <a href="matches.html?id=${match.awayTeam.id}">${match.awayTeam.name}</a></td>
                    </tr class="nextMatches_border">`;
                }

                const root = document.querySelector(".nextMatches");
                responseJSON.matches.forEach((match) => {
                    root.innerHTML += generateHTML(match);
                });
            })
    })();
</script>
</body>
</html>